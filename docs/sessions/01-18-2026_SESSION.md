# Session: 2026-01-18

## Issue: Response Format and Fermenter Parsing Failures

**Problem**: Yeast! responses lacked visible complexity/saliency scores and realizations in CLI/REPL output. Batch fermenter.js couldn't parse responses correctly, failing to extract complexity_score, saliency_score, and realizations_count from agent output.

**Root Cause**: Three-part failure:
1. **apolloClient.js**: Wasn't passing OUTLINES_API and OUTLINES_ENABLED configuration to the remote agent
2. **yeast-agent.js**: Stripped format tags from response text but never added complexity_score to return object
3. **fermenter.js**: Expected text regex tags in cleaned output that no longer exist

### Investigation Approach

1. **Configuration chain tracing**:
   - Verified .env → config.js → apolloClient.js → SSH payload flow
   - Confirmed Outlines server running on apollo.local
   - Found tag-stripping logic in yeast-agent.js and complexity_score calculation existing but unused

2. **Key Findings**:
   - apolloClient.js lines 85-86 missing outlines_enabled and outlines_api fields in SSH payload
   - yeast-agent.js had complexity_score extraction logic but wasn't including it in return object
   - fermenter.js parseOutput() relied on regex tags that were being stripped before output
   - Scores and realizations were calculated server-side but lost during response transformation

### Implementation (Completed in Parallel)

1. **apolloClient.js** (lines 85-86):
   - Added `outlines_enabled: config.outlines_enabled`
   - Added `outlines_api: config.outlines_api`
   - Configuration now flows to remote yeast-agent.js

2. **yeast-agent.js** (line 246):
   - Added `complexity_score` field to return object
   - Extracted from structured output or defaults to 0.5
   - Score now survives round-trip to client

3. **yeast.js** (lines 50-52):
   - Added conditional display of complexity_score in headless mode
   - Shows score when available, silent fallback if missing

4. **repl.js** (lines 344-346):
   - Added conditional display of complexity_score in interactive mode
   - Formatted for readable terminal output

5. **fermenter.js** (lines 20-46):
   - Rewrote parseOutput() to extract JSON fields first (complexity_score, saliency_score, realizations)
   - Regex fallback for unstructured mode maintains backward compatibility
   - Now captures all three fields reliably

### Status

All fixes implemented and tested locally. Ready for validation:
- CLI headless mode displays complexity scores
- Interactive REPL displays complexity scores
- Batch fermenter processing captures complexity_score, saliency_score, realizations_count correctly

### Branch & Status

- Changes on main (no branch created)
- All code complete, ready for user validation testing
